{% extends 'base.html' %}

{% block title %}Booking Details - Admin Panel{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Admin Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'admin_booking_list' %}">All Bookings</a></li>
            <li class="breadcrumb-item active" aria-current="page">Booking #{{ booking.id }}</li>
        </ol>
    </nav>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fas fa-calendar-check me-2"></i>Booking Information</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-4"><strong>Booking ID:</strong></div>
                        <div class="col-sm-8">#{{ booking.id }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Customer:</strong></div>
                        <div class="col-sm-8">{{ booking.customer.username }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Design:</strong></div>
                        <div class="col-sm-8">
                            {% if booking.design %}
                                {{ booking.design.name }}
                            {% else %}
                                Custom Booking
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Booking Date:</strong></div>
                        <div class="col-sm-8">{{ booking.booking_date }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Time Slot:</strong></div>
                        <div class="col-sm-8">
                            {% if booking.time_slot %}
                                {{ booking.time_slot.start_time|time:"H:i" }} - {{ booking.time_slot.end_time|time:"H:i" }}
                            {% else %}
                                {{ booking.booking_time|time:"H:i" }}
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Payment Option:</strong></div>
                        <div class="col-sm-8">
                            {% if booking.payment_option == 'full' %}
                                <span class="badge bg-success">Full Payment</span>
                            {% else %}
                                <span class="badge bg-info">Advance Payment (40%)</span>
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Status:</strong></div>
                        <div class="col-sm-8">
                            {% if booking.status == 'confirmed' %}
                                <span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>Confirmed</span>
                            {% elif booking.status == 'pending' %}
                                <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Pending</span>
                            {% elif booking.status == 'cancelled' %}
                                <span class="badge bg-danger"><i class="fas fa-times-circle me-1"></i>Cancelled</span>
                            {% elif booking.status == 'rejected' %}
                                <span class="badge bg-danger"><i class="fas fa-ban me-1"></i>Rejected</span>
                            {% elif booking.status == 'completed' %}
                                <span class="badge bg-info"><i class="fas fa-check-square me-1"></i>Completed</span>
                            {% else %}
                                <span class="badge bg-secondary"><i class="fas fa-info-circle me-1"></i>{{ booking.status|title }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Created:</strong></div>
                        <div class="col-sm-8">{{ booking.created_at }}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0"><i class="fas fa-paint-brush me-2"></i>Design Information</h3>
                </div>
                <div class="card-body">
                    {% if booking.design %}
                        {% if booking.design.image %}
                        <img src="{{ booking.design.image.url }}" class="img-fluid mb-3 rounded" alt="{{ booking.design.name }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center mb-3 rounded" style="height: 200px;">
                            <i class="fas fa-image fa-3x text-muted"></i>
                        </div>
                        {% endif %}
                        <div class="row">
                            <div class="col-sm-4"><strong>Name:</strong></div>
                            <div class="col-sm-8">{{ booking.design.name }}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-4"><strong>Category:</strong></div>
                            <div class="col-sm-8">{{ booking.design.category.name }}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-4"><strong>Sub-category:</strong></div>
                            <div class="col-sm-8">{{ booking.design.sub_category.name }}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-4"><strong>Price:</strong></div>
                            <div class="col-sm-8 text-primary fw-bold">â‚¹{{ booking.design.price }}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-4"><strong>Description:</strong></div>
                            <div class="col-sm-8">{{ booking.design.description }}</div>
                        </div>
                    {% else %}
                        <div class="row">
                            <div class="col-sm-4"><strong>Type:</strong></div>
                            <div class="col-sm-8">Custom Booking</div>
                        </div>
                        <hr>
                        {% if booking.category %}
                        <div class="row">
                            <div class="col-sm-4"><strong>Category:</strong></div>
                            <div class="col-sm-8">{{ booking.category.name }}</div>
                        </div>
                        <hr>
                        {% endif %}
                        {% if booking.subcategory %}
                        <div class="row">
                            <div class="col-sm-4"><strong>Subcategory:</strong></div>
                            <div class="col-sm-8">{{ booking.subcategory.name }}</div>
                        </div>
                        <hr>
                        {% endif %}
                        <div class="row">
                            <div class="col-sm-4"><strong>Phone:</strong></div>
                            <div class="col-sm-8">{{ booking.phone_number }}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-4"><strong>Address:</strong></div>
                            <div class="col-sm-8">
                                {{ booking.house_name }}, {{ booking.place }}, {{ booking.district }}, {{ booking.state }} - {{ booking.pincode }}
                            </div>
                        </div>
                        {% if booking.custom_design_image %}
                        <hr>
                        <div class="row">
                            <div class="col-sm-4"><strong>Design Image:</strong></div>
                            <div class="col-sm-8">
                                <img src="{{ booking.custom_design_image.url }}" class="img-fluid rounded" alt="Custom Design" style="max-height: 150px;">
                            </div>
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            
            {% if booking.status == 'confirmed' or booking.status == 'pending' %}
            <div class="card shadow mt-3">
                <div class="card-header bg-warning text-dark">
                    <h3 class="mb-0"><i class="fas fa-cogs me-2"></i>Update Status</h3>
                </div>
                <div class="card-body">
                    <form method="post" action="{% url 'admin_update_booking_status' booking.id %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="status" class="form-label">Select New Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="confirmed" {% if booking.status == 'confirmed' %}selected{% endif %}>Confirm Booking</option>
                                <option value="rejected">Reject Booking</option>
                                <option value="completed">Mark as Completed</option>
                            </select>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-sync-alt me-2"></i>Update Status
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            {% endif %}
            
            {% if booking.status == 'rejected' %}
            <div class="card shadow mt-3">
                <div class="card-header bg-info text-white">
                    <h3 class="mb-0"><i class="fas fa-refund me-2"></i>Refund Actions</h3>
                </div>
                <div class="card-body">
                    <p>Booking has been rejected. Please confirm the refund has been processed.</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'admin_confirm_refund' booking.id %}" class="btn btn-info">
                            <i class="fas fa-check-circle me-2"></i>Confirm Refund
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mt-3 text-center">
        <a href="{% url 'admin_booking_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Bookings
        </a>
    </div>
</div>
{% endblock %}