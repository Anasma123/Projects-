<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Billing List</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f4f9; padding: 30px; }
        .card { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h1 { margin-bottom: 15px; }
        .actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 8px 14px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600 textbox; text-decoration: none; }
        .btn-add { background: #2d8cf0; color: #fff; }
        .btn-edit { background: #f0ad4e; color: #fff; }
        .btn-delete { background: #e74c3c; color: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #e2e8f0; text-align: left; }
        th { background: #f7f9fc; }
        .status-final { color: #2d8cf0; font-weight: 600; }
        .status-cancelled { color: #c0392b; font-weight: 600; }
        .search { margin-bottom: 15px; display: flex; gap: 10px; }
        input { padding: 8px 10px; border: 1px solid #ccc; border-radius: 4px; flex: 1; }
    </style>
</head>
<body>
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div><h1>Billing List</h1></div>
            <div><a href="{% url 'add_billing' %}" class="btn btn-add">➕ Add Billing</a></div>
        </div>
        <div class="search">
            <form method="get" style="flex: 1; display: flex; gap: 8px;">
                <input type="text" name="q" placeholder="Search by bill ID" value="{{ q }}">
                <button type="submit" class="btn" style="background: #4CAF50; color: #fff;">Search</button>
            </form>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Bill ID</th>
                    <th>Date</th>
                    <th>Subtotal</th>
                    <th>GST</th>
                    <th>Round Off</th>
                    <th>Final Amount</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for bill in bills %}
                <tr>
                    <td>{{ bill.id }}</td>
                    <td>{{ bill.created_at|date:"Y-m-d H:i" }}</td>
                    <td>₹{{ bill.subtotal|floatformat:2 }}</td>
                    <td>₹{{ bill.gst_amount|floatformat:2 }}</td>
                    <td>₹{{ bill.roundoff|floatformat:2 }}</td>
                    <td>₹{{ bill.final_amount|floatformat:2 }}</td>
                    <td class="status-{{ bill.status }}">{{ bill.get_status_display }}</td>
                    <td>
                        <a href="{% url 'edit_billing' bill.id %}" class="btn btn-edit">Edit</a>
                        <a href="{% url 'delete_billing' bill.id %}" class="btn btn-delete">Cancel</a>
                    </td>
                </tr>
                <tr>
                    <td colspan="8" style="padding: 0;">
                        <div style="background: #f9f9f9; padding: 10px 15px; border-top: 1px solid #ddd;">
                            <strong>Items:</strong>
                            <table style="width: 100%; margin-top: 5px; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="border: 1px solid #ccc; padding: 6px;">Product</th>
                                        <th style="border: 1px solid #ccc; padding: 6px;">Category</th>
                                        <th style="border: 1px solid #ccc; padding: 6px;">Subcategory</th>
                                        <th style="border: 1px solid #ccc; padding: 6px;">Qty</th>
                                        <th style="border: 1px solid #ccc; padding: 6px;">Line Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in bill.items.all %}
                                    <tr>
                                        <td style="border: 1px solid #ccc; padding: 6px;">{{ item.product.name }}</td>
                                        <td style="border: 1px solid #ccc; padding: 6px;">{{ item.product.category.name|default:"N/A" }}</td>
                                        <td style="border: 1px solid #ccc; padding: 6px;">{{ item.product.subcategory.name|default:"N/A" }}</td>
                                        <td style="border: 1px solid #ccc; padding: 6px;">{{ item.quantity }}</td>
                                        <td style="border: 1px solid #ccc; padding: 6px;">₹{{ item.line_total|floatformat:2 }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="8" style="text-align: center;">No billing records.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>